# å·¥ä½œæµé…ç½®æ³¨å†Œé—®é¢˜ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯ï¼š**
```
è¿è¡Œå‘½ä»¤ scriptButler.createWorkflow é”™è¯¯ï¼šæ²¡æœ‰æ³¨å†Œé…ç½® scriptButler.workflowsï¼Œå› æ­¤æ— æ³•å†™å…¥å·¥ä½œåŒºè®¾ç½®ã€‚è¿™å¯èƒ½æ˜¯ç”±æäº¤ scriptButler.createWorkflow çš„æ‰©å±•å¼•èµ·çš„ã€‚
```

**è§¦å‘åœºæ™¯ï¼š**
1. æ‰“å¼€"è„šæœ¬ç®¡å®¶"ä¾§è¾¹æ 
2. ç‚¹å‡»"å·¥ä½œæµ"è§†å›¾çš„ â• æŒ‰é’®
3. å°è¯•åˆ›å»ºå·¥ä½œæµ

**é—®é¢˜åŸå› ï¼š**
- `WorkflowManager` ä½¿ç”¨ `scriptButler.workflows` é…ç½®é”®ä¿å­˜å·¥ä½œæµåˆ°å·¥ä½œåŒºè®¾ç½®
- `package.json` ä¸­çš„ `contributes.configuration.properties` ç¼ºå°‘ `scriptButler.workflows` é…ç½®é¡¹å£°æ˜
- VS Code ä¸å…è®¸å†™å…¥æœªæ³¨å†Œçš„é…ç½®é¡¹

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶ï¼š`package.json`

**ä½ç½®ï¼š** `contributes.configuration.properties`

**æ–°å¢é…ç½®é¡¹ï¼š**

```json
{
  "scriptButler.workflows": {
    "type": "array",
    "default": [],
    "description": "å·¥ä½œæµé…ç½®ï¼ˆè‡ªåŠ¨ç®¡ç†ï¼Œè¯·å‹¿æ‰‹åŠ¨ç¼–è¾‘ï¼‰",
    "items": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "å·¥ä½œæµå”¯ä¸€æ ‡è¯†ç¬¦"
        },
        "name": {
          "type": "string",
          "description": "å·¥ä½œæµåç§°"
        },
        "description": {
          "type": "string",
          "description": "å·¥ä½œæµæè¿°"
        },
        "steps": {
          "type": "array",
          "description": "å·¥ä½œæµæ­¥éª¤",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["script", "command"],
                "description": "æ­¥éª¤ç±»å‹"
              },
              "scriptName": {
                "type": "string",
                "description": "NPM è„šæœ¬åç§°ï¼ˆtype=script æ—¶ä½¿ç”¨ï¼‰"
              },
              "packageJsonPath": {
                "type": "string",
                "description": "package.json è·¯å¾„ï¼ˆtype=script æ—¶ä½¿ç”¨ï¼‰"
              },
              "command": {
                "type": "string",
                "description": "ä»»æ„å‘½ä»¤ï¼ˆtype=command æ—¶ä½¿ç”¨ï¼‰"
              },
              "mode": {
                "type": "string",
                "enum": ["serial", "parallel"],
                "description": "æ‰§è¡Œæ¨¡å¼ï¼šä¸²è¡Œæˆ–å¹¶è¡Œ"
              },
              "continueOnError": {
                "type": "boolean",
                "description": "å¤±è´¥åæ˜¯å¦ç»§ç»­æ‰§è¡Œ"
              }
            }
          }
        }
      }
    },
    "scope": "resource",
    "order": 20
  }
}
```

**å…³é”®å±æ€§è¯´æ˜ï¼š**

| å±æ€§ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `type` | `"array"` | å·¥ä½œæµåˆ—è¡¨ |
| `default` | `[]` | é»˜è®¤ä¸ºç©ºæ•°ç»„ |
| `scope` | `"resource"` | å·¥ä½œåŒºçº§åˆ«é…ç½® |
| `order` | `20` | åœ¨è®¾ç½®ç•Œé¢ä¸­çš„æ˜¾ç¤ºé¡ºåº |
| `items.type` | `"object"` | æ¯ä¸ªå·¥ä½œæµæ˜¯ä¸€ä¸ªå¯¹è±¡ |

---

## ğŸ“Š é…ç½®é¡¹ç»“æ„

### å®Œæ•´çš„å·¥ä½œæµé…ç½®ç¤ºä¾‹

```json
{
  "scriptButler.workflows": [
    {
      "id": "workflow-1234567890",
      "name": "å‰åç«¯è”åˆéƒ¨ç½²",
      "description": "æ„å»ºå‰ç«¯ã€æµ‹è¯•åç«¯ã€éƒ¨ç½²åº”ç”¨",
      "steps": [
        {
          "type": "command",
          "command": "cd packages/frontend",
          "mode": "serial",
          "continueOnError": false
        },
        {
          "type": "command",
          "command": "npm install",
          "mode": "serial",
          "continueOnError": false
        },
        {
          "type": "script",
          "scriptName": "build",
          "packageJsonPath": "d:\\project\\packages\\frontend\\package.json",
          "mode": "serial",
          "continueOnError": false
        },
        {
          "type": "command",
          "command": "cd ../backend",
          "mode": "serial",
          "continueOnError": false
        },
        {
          "type": "script",
          "scriptName": "test",
          "packageJsonPath": "d:\\project\\packages\\backend\\package.json",
          "mode": "serial",
          "continueOnError": false
        }
      ]
    }
  ]
}
```

---

## ğŸ” ç›¸å…³ä»£ç 

### `WorkflowManager` ä½¿ç”¨é…ç½®çš„æ–¹å¼

**æ–‡ä»¶ï¼š** `src/workflowManager.ts`

```typescript
const WORKFLOW_CONFIG_KEY = 'scriptButler.workflows';

export class WorkflowManager {
    private workflows: Workflow[] = [];

    constructor() {
        this.loadWorkflows();
    }

    /**
     * ä» workspace settings åŠ è½½å·¥ä½œæµ
     */
    private loadWorkflows(): void {
        const config = vscode.workspace.getConfiguration();
        const stored = config.get<Workflow[]>(WORKFLOW_CONFIG_KEY, []);
        this.workflows = stored;
    }

    /**
     * ä¿å­˜å·¥ä½œæµåˆ° workspace settings
     */
    private async saveWorkflows(): Promise<void> {
        const config = vscode.workspace.getConfiguration();
        await config.update(
            WORKFLOW_CONFIG_KEY,
            this.workflows,
            vscode.ConfigurationTarget.Workspace  // ä¿å­˜åˆ°å·¥ä½œåŒºè®¾ç½®
        );
    }
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… ä½¿ç”¨ `vscode.workspace.getConfiguration()` è·å–é…ç½®
- âœ… ä½¿ç”¨ `config.update()` æ›´æ–°é…ç½®
- âœ… ä½¿ç”¨ `ConfigurationTarget.Workspace` ä¿å­˜åˆ°å·¥ä½œåŒºè®¾ç½®
- âœ… é…ç½®é”®ä¸º `scriptButler.workflows`

---

## âœ… éªŒè¯æ­¥éª¤

### 1. é‡æ–°åŠ è½½æ‰©å±•

- æŒ‰ `F5` å¯åŠ¨è°ƒè¯•
- æˆ–æ‰§è¡Œ "Developer: Reload Window"

### 2. åˆ›å»ºå·¥ä½œæµ

1. æ‰“å¼€"è„šæœ¬ç®¡å®¶"ä¾§è¾¹æ 
2. ç‚¹å‡»"å·¥ä½œæµ"è§†å›¾çš„ â• æŒ‰é’®
3. è¾“å…¥å·¥ä½œæµåç§°
4. é€‰æ‹©åˆ›å»ºæ–¹å¼ï¼ˆä»åˆ—è¡¨é€‰æ‹© æˆ– æ–‡æœ¬è¾“å…¥ï¼‰
5. å®Œæˆåˆ›å»º

**é¢„æœŸç»“æœï¼š**
- âœ… ä¸å†æ˜¾ç¤ºé…ç½®æ³¨å†Œé”™è¯¯
- âœ… å·¥ä½œæµåˆ›å»ºæˆåŠŸ
- âœ… æ˜¾ç¤ºæç¤ºï¼š"å·¥ä½œæµ "XXX" å·²åˆ›å»º"

### 3. æ£€æŸ¥å·¥ä½œåŒºè®¾ç½®

1. æ‰“å¼€ `.vscode/settings.json`
2. æŸ¥çœ‹æ˜¯å¦æœ‰ `scriptButler.workflows` é…ç½®é¡¹
3. éªŒè¯å·¥ä½œæµæ•°æ®æ˜¯å¦æ­£ç¡®ä¿å­˜

**é¢„æœŸå†…å®¹ï¼š**
```json
{
  "scriptButler.workflows": [
    {
      "id": "workflow-1234567890",
      "name": "æµ‹è¯•å·¥ä½œæµ",
      "description": "æµ‹è¯•æè¿°",
      "steps": [
        {
          "type": "script",
          "scriptName": "build",
          "packageJsonPath": "d:\\project\\package.json",
          "mode": "serial",
          "continueOnError": false
        }
      ]
    }
  ]
}
```

### 4. æµ‹è¯•å·¥ä½œæµæŒä¹…åŒ–

1. åˆ›å»ºä¸€ä¸ªå·¥ä½œæµ
2. å…³é—­å¹¶é‡æ–°æ‰“å¼€ VS Code
3. æ‰“å¼€"å·¥ä½œæµ"è§†å›¾
4. éªŒè¯å·¥ä½œæµæ˜¯å¦ä»ç„¶å­˜åœ¨

**é¢„æœŸç»“æœï¼š**
- âœ… å·¥ä½œæµæŒä¹…åŒ–ä¿å­˜
- âœ… é‡å¯åä»ç„¶å¯è§

### 5. æµ‹è¯•å·¥ä½œæµæ‰§è¡Œ

1. ç‚¹å‡»å·¥ä½œæµåç§°
2. éªŒè¯å·¥ä½œæµæ˜¯å¦æ­£ç¡®æ‰§è¡Œ
3. éªŒè¯æ­¥éª¤æ˜¯å¦æŒ‰é¡ºåºæ‰§è¡Œ

**é¢„æœŸç»“æœï¼š**
- âœ… å·¥ä½œæµæ­£å¸¸æ‰§è¡Œ
- âœ… æ­¥éª¤æŒ‰é¡ºåºæ‰§è¡Œ
- âœ… æ˜¾ç¤ºæ‰§è¡Œè¿›åº¦

---

## ğŸ“š VS Code é…ç½®è§„èŒƒ

### é…ç½®é¡¹å£°æ˜çš„å¿…è¦æ€§

**ä¸ºä»€ä¹ˆéœ€è¦å£°æ˜é…ç½®é¡¹ï¼Ÿ**

1. **ç±»å‹å®‰å…¨**
   - VS Code æ ¹æ®å£°æ˜éªŒè¯é…ç½®å€¼çš„ç±»å‹
   - é˜²æ­¢ç”¨æˆ·è¾“å…¥é”™è¯¯çš„æ•°æ®ç±»å‹

2. **ç”¨æˆ·ä½“éªŒ**
   - åœ¨è®¾ç½®ç•Œé¢ä¸­æ˜¾ç¤ºé…ç½®é¡¹
   - æä¾›æè¿°å’Œé»˜è®¤å€¼
   - æ”¯æŒè‡ªåŠ¨è¡¥å…¨

3. **æƒé™æ§åˆ¶**
   - åªæœ‰å£°æ˜çš„é…ç½®é¡¹æ‰èƒ½è¢«æ‰©å±•å†™å…¥
   - é˜²æ­¢æ‰©å±•éšæ„ä¿®æ”¹é…ç½®

4. **æ–‡æ¡£åŒ–**
   - é…ç½®é¡¹çš„æè¿°ä½œä¸ºæ–‡æ¡£
   - ç”¨æˆ·å¯ä»¥åœ¨è®¾ç½®ç•Œé¢ä¸­æŸ¥çœ‹

### é…ç½®é¡¹çš„ scope å±æ€§

| Scope | è¯´æ˜ | ä¿å­˜ä½ç½® |
|-------|------|----------|
| `application` | åº”ç”¨çº§åˆ« | ç”¨æˆ·è®¾ç½® |
| `window` | çª—å£çº§åˆ« | ç”¨æˆ·è®¾ç½® |
| `resource` | èµ„æºçº§åˆ« | å·¥ä½œåŒºè®¾ç½® |
| `machine` | æœºå™¨çº§åˆ« | ç”¨æˆ·è®¾ç½®ï¼ˆä¸åŒæ­¥ï¼‰ |

**å·¥ä½œæµä½¿ç”¨ `resource` scopeï¼š**
- âœ… ä¿å­˜åˆ°å·¥ä½œåŒºè®¾ç½®ï¼ˆ`.vscode/settings.json`ï¼‰
- âœ… æ¯ä¸ªé¡¹ç›®å¯ä»¥æœ‰ä¸åŒçš„å·¥ä½œæµ
- âœ… ä¸ä¼šå½±å“å…¶ä»–é¡¹ç›®

---

## ğŸ‰ æ€»ç»“

**é—®é¢˜ï¼š** åˆ›å»ºå·¥ä½œæµæ—¶æŠ¥é”™"æ²¡æœ‰æ³¨å†Œé…ç½® scriptButler.workflows"

**åŸå› ï¼š** `package.json` ä¸­ç¼ºå°‘ `scriptButler.workflows` é…ç½®é¡¹å£°æ˜

**è§£å†³æ–¹æ¡ˆï¼š** åœ¨ `contributes.configuration.properties` ä¸­æ·»åŠ é…ç½®é¡¹å£°æ˜

**ä¿®å¤å†…å®¹ï¼š**
- âœ… æ·»åŠ  `scriptButler.workflows` é…ç½®é¡¹
- âœ… å®šä¹‰å®Œæ•´çš„ JSON Schema
- âœ… è®¾ç½® `scope: "resource"` ä¿å­˜åˆ°å·¥ä½œåŒº
- âœ… æ·»åŠ è¯¦ç»†çš„æè¿°ä¿¡æ¯

**éªŒè¯ç»“æœï¼š**
- âœ… ç¼–è¯‘æˆåŠŸ
- âœ… æ—  JSON è¯­æ³•é”™è¯¯
- âœ… é…ç½®é¡¹æ­£ç¡®æ³¨å†Œ

**ç°åœ¨å¯ä»¥æ­£å¸¸åˆ›å»ºå’Œä¿å­˜å·¥ä½œæµäº†ï¼** ğŸš€

---

## ğŸ“– ç›¸å…³é—®é¢˜

### ç±»ä¼¼çš„é…ç½®æ³¨å†Œé—®é¢˜

ä¹‹å‰ä¿®å¤è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼š

1. **ç»ˆç«¯ç›‘å¬é…ç½®æ³¨å†Œé—®é¢˜**
   - é—®é¢˜ï¼š`configuration` å¯¹è±¡ä½ç½®é”™è¯¯
   - è§£å†³ï¼šå°† `configuration` ç§»åˆ° `contributes` å†…éƒ¨

2. **å·¥ä½œæµé…ç½®æ³¨å†Œé—®é¢˜**ï¼ˆæœ¬æ¬¡ï¼‰
   - é—®é¢˜ï¼šç¼ºå°‘ `scriptButler.workflows` é…ç½®é¡¹å£°æ˜
   - è§£å†³ï¼šæ·»åŠ é…ç½®é¡¹å£°æ˜

**ç»éªŒæ•™è®­ï¼š**
- âœ… æ‰€æœ‰éœ€è¦å†™å…¥çš„é…ç½®é¡¹éƒ½å¿…é¡»åœ¨ `package.json` ä¸­å£°æ˜
- âœ… `configuration` å¿…é¡»åœ¨ `contributes` å†…éƒ¨
- âœ… é…ç½®é¡¹éœ€è¦å®Œæ•´çš„ JSON Schema å®šä¹‰
- âœ… ä½¿ç”¨æ­£ç¡®çš„ `scope` å±æ€§

---

## ğŸ”— å‚è€ƒèµ„æ–™

- [VS Code Extension API - Configuration](https://code.visualstudio.com/api/references/contribution-points#contributes.configuration)
- [JSON Schema](https://json-schema.org/)
- [VS Code Configuration Scopes](https://code.visualstudio.com/api/references/contribution-points#Configuration-property-schema)

