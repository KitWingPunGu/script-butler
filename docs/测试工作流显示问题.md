# 测试工作流显示问题修复

## 🎯 测试目标

验证工作流创建后能够立即显示在列表中，无需手动刷新。

---

## 📋 测试前准备

### 1. 打开开发者工具

- **Windows/Linux**: 按 `Ctrl+Shift+I`
- **Mac**: 按 `Cmd+Option+I`
- 切换到 **Console** 标签

### 2. 清空现有工作流（可选）

打开 `.vscode/settings.json`，确保工作流列表为空：

```json
{
    "scriptButler.workflows": []
}
```

---

## 🧪 测试用例

### 测试 1: 创建工作流

**步骤：**

1. 在 VS Code 侧边栏找到"工作流"视图
2. 点击 **"+"** 按钮（创建工作流）
3. 输入工作流名称：`测试工作流1`
4. 输入描述（可选）：`这是一个测试工作流`
5. 选择创建方式（从列表选择或文本输入）
6. 添加至少一个步骤
7. 确认创建

**预期结果：**

✅ **控制台日志：**
```
[WorkflowManager] 创建工作流: 测试工作流1 (ID: workflow-xxxxxxxxxx)
[WorkflowManager] 当前工作流数量: 1
[WorkflowManager] 正在保存 1 个工作流: ["测试工作流1"]
[WorkflowManager] 工作流已保存到配置
[WorkflowManager] 工作流 "测试工作流1" 创建完成
[WorkflowTreeProvider] refresh() - 当前工作流数量: 1 ["测试工作流1"]
```

✅ **UI 显示：**
- 新工作流 "测试工作流1" **立即**显示在工作流列表中
- 无需手动刷新或重启

---

### 测试 2: 创建第二个工作流

**步骤：**

1. 再次点击 **"+"** 按钮
2. 输入工作流名称：`测试工作流2`
3. 添加步骤并确认

**预期结果：**

✅ **控制台日志：**
```
[WorkflowManager] 创建工作流: 测试工作流2 (ID: workflow-xxxxxxxxxx)
[WorkflowManager] 当前工作流数量: 2
[WorkflowManager] 正在保存 2 个工作流: ["测试工作流1", "测试工作流2"]
[WorkflowManager] 工作流已保存到配置
[WorkflowManager] 工作流 "测试工作流2" 创建完成
[WorkflowTreeProvider] refresh() - 当前工作流数量: 2 ["测试工作流1", "测试工作流2"]
```

✅ **UI 显示：**
- 两个工作流都显示在列表中
- 新工作流立即出现

---

### 测试 3: 编辑工作流

**步骤：**

1. 右键点击 "测试工作流1"
2. 选择 **"编辑工作流"**
3. 修改名称为：`测试工作流1-已编辑`
4. 修改描述
5. 确认保存

**预期结果：**

✅ **控制台日志：**
```
[WorkflowManager] 正在保存 2 个工作流: ["测试工作流1-已编辑", "测试工作流2"]
[WorkflowManager] 工作流已保存到配置
[WorkflowTreeProvider] refresh() - 当前工作流数量: 2 ["测试工作流1-已编辑", "测试工作流2"]
```

✅ **UI 显示：**
- 工作流名称立即更新为 "测试工作流1-已编辑"
- 无需手动刷新

---

### 测试 4: 删除工作流

**步骤：**

1. 右键点击 "测试工作流2"
2. 选择 **"删除工作流"**
3. 确认删除

**预期结果：**

✅ **控制台日志：**
```
[WorkflowManager] 正在保存 1 个工作流: ["测试工作流1-已编辑"]
[WorkflowManager] 工作流已保存到配置
[WorkflowTreeProvider] refresh() - 当前工作流数量: 1 ["测试工作流1-已编辑"]
```

✅ **UI 显示：**
- "测试工作流2" 立即从列表中消失
- 只剩下 "测试工作流1-已编辑"

---

### 测试 5: 手动编辑配置文件

**步骤：**

1. 打开 `.vscode/settings.json`
2. 手动添加一个工作流：

```json
{
    "scriptButler.workflows": [
        {
            "id": "workflow-manual",
            "name": "手动添加的工作流",
            "description": "通过编辑配置文件添加",
            "steps": [
                {
                    "type": "command",
                    "command": "echo 'Hello World'",
                    "mode": "serial",
                    "continueOnError": false
                }
            ]
        }
    ]
}
```

3. 保存文件

**预期结果：**

✅ **控制台日志：**
```
[ScriptButler] Workflow configuration changed, reloading...
[WorkflowTreeProvider] reload() - 从配置文件重新加载工作流
[WorkflowManager] 已加载 1 个工作流: ["手动添加的工作流"]
[WorkflowTreeProvider] reload() - 重新加载后工作流数量: 1 ["手动添加的工作流"]
```

✅ **UI 显示：**
- "手动添加的工作流" 自动出现在列表中
- 无需手动刷新

---

## ❌ 问题排查

### 如果工作流没有显示

1. **检查控制台日志**
   - 是否有错误信息？
   - 工作流数量是否正确？

2. **检查配置文件**
   - 打开 `.vscode/settings.json`
   - 查看 `scriptButler.workflows` 是否包含新创建的工作流

3. **手动刷新**
   - 点击刷新按钮（如果有）
   - 或重新加载 VS Code 窗口

4. **查看完整日志**
   - 在控制台搜索 `[WorkflowManager]` 或 `[WorkflowTreeProvider]`
   - 查看完整的数据流转过程

---

## 📊 测试结果记录

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 创建工作流 | ⬜ 通过 / ⬜ 失败 | |
| 创建第二个工作流 | ⬜ 通过 / ⬜ 失败 | |
| 编辑工作流 | ⬜ 通过 / ⬜ 失败 | |
| 删除工作流 | ⬜ 通过 / ⬜ 失败 | |
| 手动编辑配置 | ⬜ 通过 / ⬜ 失败 | |

---

## 🎉 测试完成

如果所有测试用例都通过，说明工作流显示问题已经完全修复！

如果有任何测试失败，请：
1. 记录失败的测试用例
2. 复制控制台日志
3. 检查 `.vscode/settings.json` 的内容
4. 提供详细的错误信息以便进一步诊断

