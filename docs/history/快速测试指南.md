# 快速测试指南

## 🚀 启动扩展

1. **在主 VS Code 窗口按 `F5`**
2. **在扩展开发主机窗口中**：
   - 文件 → 打开文件夹 → 选择 `test-workspace`
3. **点击侧边栏的 NPM 图标** 📦

---

## ✅ 测试 1：包管理器自动检测

### 测试 pnpm 检测

**步骤：**
1. 确认 `test-workspace` 目录中有 `pnpm-lock.yaml` 文件 ✅（已创建）
2. 在 NPM 脚本面板中，点击任意脚本（如 "dev"）
3. 查看打开的终端

**预期结果：**
- ✅ 终端名称显示：`pnpm: dev`
- ✅ 执行的命令是：`pnpm run dev`
- ✅ 通知消息显示：`正在运行 (pnpm): dev`

---

### 测试手动配置

**步骤：**
1. 打开设置（`Ctrl+,`）
2. 搜索 `npmScriptManager.packageManager`
3. 选择 `yarn`
4. 运行任意脚本

**预期结果：**
- ✅ 终端名称显示：`Yarn: <script>`
- ✅ 执行的命令是：`yarn <script>`

---

### 测试自动回退到 npm

**步骤：**
1. 删除或重命名 `test-workspace/pnpm-lock.yaml`
2. 刷新脚本列表（点击刷新按钮）
3. 运行任意脚本

**预期结果：**
- ✅ 终端名称显示：`npm: <script>`
- ✅ 执行的命令是：`npm run <script>`

---

## ✅ 测试 2：收藏夹同步更新

### 测试命令内容更新

**步骤：**
1. 在脚本列表中，右键点击 "dev" → 添加到收藏夹
2. 打开 `test-workspace/package.json`
3. 修改 "dev" 脚本的命令：
   ```json
   // 修改前
   "dev": "echo 'Development mode'"
   
   // 修改后
   "dev": "echo 'New development command'"
   ```
4. 保存文件
5. 查看收藏夹面板

**预期结果：**
- ✅ 收藏夹中的 "dev" 脚本自动显示新命令
- ✅ 描述文本更新为：`echo 'New development command'`

---

### 测试脚本删除

**步骤：**
1. 收藏 "build" 和 "test" 脚本
2. 打开 `test-workspace/package.json`
3. 删除 "build" 脚本：
   ```json
   // 修改前
   {
     "dev": "...",
     "build": "...",
     "test": "..."
   }
   
   // 修改后（删除 build）
   {
     "dev": "...",
     "test": "..."
   }
   ```
4. 保存文件
5. 点击刷新按钮

**预期结果：**
- ✅ 显示通知：`NPM 脚本已刷新，已移除 1 个失效的收藏`
- ✅ 收藏夹中不再显示 "build"
- ✅ "test" 仍然在收藏夹中

---

### 测试自动清理（文件监视器）

**步骤：**
1. 收藏多个脚本（如 "dev", "test", "lint"）
2. 打开 `test-workspace/package.json`
3. 删除其中 2 个脚本
4. 保存文件（**不要点击刷新按钮**）
5. 等待 1-2 秒，查看收藏夹

**预期结果：**
- ✅ 收藏夹自动更新
- ✅ 删除的脚本自动从收藏夹移除
- ✅ 无需手动刷新

---

## ✅ 测试 3：多包管理器切换

### 测试配置优先级

**步骤：**
1. 确保 `test-workspace` 中有 `pnpm-lock.yaml`
2. 设置中选择 `npmScriptManager.packageManager` = `npm`
3. 运行脚本

**预期结果：**
- ✅ 使用 npm（手动配置优先于自动检测）
- ✅ 终端显示：`npm: <script>`

---

### 测试 Yarn Berry 检测

**步骤：**
1. 在 `test-workspace` 中创建 `.yarnrc.yml` 文件：
   ```yaml
   nodeLinker: node-modules
   yarnPath: .yarn/releases/yarn-3.6.0.cjs
   ```
2. 创建 `yarn.lock` 文件（空文件即可）
3. 删除 `pnpm-lock.yaml`
4. 设置中选择 `auto`
5. 刷新并运行脚本

**预期结果：**
- ✅ 检测为 Yarn Berry
- ✅ 执行命令：`yarn run <script>`

---

## 🎯 完整测试流程

### 1. 基础功能测试

- [ ] 扩展激活成功
- [ ] 侧边栏显示 NPM 脚本图标
- [ ] 脚本列表正确显示
- [ ] 点击脚本能执行
- [ ] 收藏夹功能正常

### 2. 包管理器测试

- [ ] pnpm 自动检测
- [ ] npm 回退
- [ ] 手动配置生效
- [ ] Yarn 检测
- [ ] Yarn Berry 检测

### 3. 收藏夹同步测试

- [ ] 命令更新自动同步
- [ ] 脚本删除自动清理
- [ ] 文件监视器触发清理
- [ ] 手动刷新触发清理
- [ ] 清理通知正确显示

### 4. 界面测试

- [ ] 所有文本显示为中文
- [ ] 终端名称正确显示包管理器
- [ ] 通知消息包含包管理器信息
- [ ] 图标正确显示

---

## 🐛 常见问题

### 问题 1：终端仍显示 "NPM: <script>"

**原因：** 代码未重新编译

**解决：**
```bash
npm run compile
```
然后按 `Ctrl+R` 重新加载扩展开发主机窗口

---

### 问题 2：收藏夹未自动清理

**原因：** 文件监视器可能有延迟

**解决：**
- 手动点击刷新按钮
- 或等待 2-3 秒

---

### 问题 3：包管理器检测错误

**原因：** 缓存未清除

**解决：**
- 重新加载扩展开发主机窗口（`Ctrl+R`）
- 或重启扩展（关闭扩展开发主机，重新按 `F5`）

---

## 📊 测试检查表

### 包管理器检测 ✅

| 场景 | 锁文件 | 预期包管理器 | 测试结果 |
|------|--------|-------------|---------|
| pnpm 项目 | pnpm-lock.yaml | pnpm | ⬜ |
| npm 项目 | package-lock.json | npm | ⬜ |
| Yarn 项目 | yarn.lock | yarn | ⬜ |
| Yarn Berry | yarn.lock + .yarnrc.yml | yarn-berry | ⬜ |
| 手动配置 | 任意 | 配置值 | ⬜ |

### 收藏夹同步 ✅

| 场景 | 操作 | 预期结果 | 测试结果 |
|------|------|---------|---------|
| 命令更新 | 修改脚本命令 | 自动同步 | ⬜ |
| 脚本删除 | 删除脚本 | 自动移除 | ⬜ |
| 手动刷新 | 点击刷新 | 清理失效 | ⬜ |
| 文件监视 | 保存文件 | 自动清理 | ⬜ |
| 清理通知 | 有失效收藏 | 显示数量 | ⬜ |

---

## 🎉 测试完成

如果所有测试都通过，恭喜！扩展已经完全正常工作了！

**下一步：**
1. 根据需要选择扩展名称（推荐：脚本管家）
2. 更新 README 和文档
3. 准备发布到 VS Code 市场

---

**需要帮助？** 查看 `更新说明.md` 了解详细的功能说明

