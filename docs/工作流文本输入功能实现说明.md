# å·¥ä½œæµæ–‡æœ¬è¾“å…¥åŠŸèƒ½å®ç°è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

**ç”¨æˆ·éœ€æ±‚ï¼š**
æ”¹è¿›å·¥ä½œæµåˆ›å»ºåŠŸèƒ½ï¼Œæ”¯æŒé€šè¿‡æ–‡æœ¬è¾“å…¥çš„æ–¹å¼åˆ›å»ºå·¥ä½œæµï¼Œå…è®¸ç”¨æˆ·ç›´æ¥è¾“å…¥å¤šè¡Œå‘½ä»¤ã€‚

**å½“å‰é—®é¢˜ï¼š**
1. åªèƒ½ä»ç°æœ‰çš„ NPM è„šæœ¬åˆ—è¡¨ä¸­é€‰æ‹©
2. æ— æ³•æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤ï¼ˆå¦‚ `cd XXX`ï¼‰
3. æ— æ³•æ·»åŠ å¸¦å‚æ•°çš„å‘½ä»¤ï¼ˆå¦‚ `npm install package-name`ï¼‰
4. æ— æ³•æ··åˆä½¿ç”¨ NPM è„šæœ¬å’Œå…¶ä»–å‘½ä»¤
5. åˆ›å»ºå¤æ‚å·¥ä½œæµæ—¶æ“ä½œç¹ç

**è§£å†³æ–¹æ¡ˆï¼š**
æä¾›ä¸¤ç§å·¥ä½œæµåˆ›å»ºæ¨¡å¼ï¼š
- **æ¨¡å¼ 1ï¼š** ä»åˆ—è¡¨é€‰æ‹©ï¼ˆä¿ç•™ç°æœ‰åŠŸèƒ½ï¼‰
- **æ¨¡å¼ 2ï¼š** æ–‡æœ¬è¾“å…¥ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰- æ”¯æŒä»»æ„ shell å‘½ä»¤

---

## âœ… å®ç°å†…å®¹

### 1. æ‰©å±• `WorkflowStep` ç±»å‹

**æ–‡ä»¶ï¼š** `src/types.ts`

#### **æ–°å¢ç±»å‹å®šä¹‰**

```typescript
/**
 * å·¥ä½œæµæ­¥éª¤ç±»å‹
 */
export type WorkflowStepType = 'script' | 'command';

/**
 * å·¥ä½œæµæ­¥éª¤
 */
export interface WorkflowStep {
    type?: WorkflowStepType;       // æ­¥éª¤ç±»å‹ï¼šscriptï¼ˆNPMè„šæœ¬ï¼‰æˆ– commandï¼ˆä»»æ„å‘½ä»¤ï¼‰
    scriptName?: string;           // NPM è„šæœ¬åç§°ï¼ˆtype=script æ—¶ä½¿ç”¨ï¼‰
    packageJsonPath?: string;      // package.json è·¯å¾„ï¼ˆtype=script æ—¶ä½¿ç”¨ï¼‰
    command?: string;              // ä»»æ„å‘½ä»¤ï¼ˆtype=command æ—¶ä½¿ç”¨ï¼‰
    mode: 'serial' | 'parallel';   // ä¸²è¡Œæˆ–å¹¶è¡Œ
    continueOnError?: boolean;     // å¤±è´¥åæ˜¯å¦ç»§ç»­
}
```

**å…³é”®å˜åŒ–ï¼š**
- âœ… æ–°å¢ `type` å­—æ®µåŒºåˆ†æ­¥éª¤ç±»å‹
- âœ… æ–°å¢ `command` å­—æ®µå­˜å‚¨ä»»æ„å‘½ä»¤
- âœ… `scriptName` å’Œ `packageJsonPath` æ”¹ä¸ºå¯é€‰ï¼ˆå…¼å®¹æ—§æ ¼å¼ï¼‰

---

### 2. åˆ›å»º `WorkflowCreator` æ¨¡å—

**æ–‡ä»¶ï¼š** `src/workflowCreator.ts`

#### **ä¸»è¦åŠŸèƒ½**

1. **`createWorkflow(allScripts)`**
   - æ˜¾ç¤ºå·¥ä½œæµåˆ›å»ºå¯¹è¯æ¡†
   - è®©ç”¨æˆ·é€‰æ‹©åˆ›å»ºæ¨¡å¼
   - è¿”å›å·¥ä½œæµé…ç½®

2. **`createFromList(allScripts)`**
   - æ¨¡å¼ 1ï¼šä»åˆ—è¡¨é€‰æ‹© NPM è„šæœ¬
   - ä¿ç•™åŸæœ‰åŠŸèƒ½

3. **`createFromText()`**
   - æ¨¡å¼ 2ï¼šæ–‡æœ¬è¾“å…¥ä»»æ„å‘½ä»¤
   - ä½¿ç”¨ä¸´æ—¶ç¼–è¾‘å™¨æä¾›å¤šè¡Œè¾“å…¥ä½“éªŒ
   - æ”¯æŒæ³¨é‡Šï¼ˆä»¥ `#` å¼€å¤´çš„è¡Œï¼‰

4. **`showMultilineInput()`**
   - æ‰“å¼€ä¸´æ—¶ç¼–è¾‘å™¨è¿›è¡Œå¤šè¡Œè¾“å…¥
   - æä¾›è¯­æ³•é«˜äº®ï¼ˆshellscriptï¼‰
   - ç”¨æˆ·å®Œæˆåç‚¹å‡»"ç¡®å®š"

#### **ä½¿ç”¨ç¤ºä¾‹**

```typescript
const workflowCreator = new WorkflowCreator();
const result = await workflowCreator.createWorkflow(allScripts);

if (result) {
    await workflowManager.createWorkflow(
        result.name,
        result.description,
        result.steps
    );
}
```

---

### 3. æ›´æ–° `WorkflowExecutor` æ”¯æŒä»»æ„å‘½ä»¤

**æ–‡ä»¶ï¼š** `src/workflowExecutor.ts`

#### **æ–°å¢æ–¹æ³•**

```typescript
/**
 * æ‰§è¡Œä»»æ„å‘½ä»¤
 */
private async executeCommand(
    workflowName: string,
    stepNumber: number,
    totalSteps: number,
    step: WorkflowStep
): Promise<void> {
    // è·å–æˆ–åˆ›å»ºç»ˆç«¯
    const terminal = vscode.window.activeTerminal || vscode.window.createTerminal('å·¥ä½œæµ');
    terminal.show();

    // å‘é€å‘½ä»¤åˆ°ç»ˆç«¯
    terminal.sendText(step.command);

    // å¦‚æœæ˜¯ä¸²è¡Œæ¨¡å¼ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
    if (step.mode === 'serial') {
        const result = await vscode.window.showInformationMessage(
            `å‘½ä»¤ "${step.command}" æ­£åœ¨æ‰§è¡Œï¼Œå®Œæˆåè¯·ç‚¹å‡»"ç»§ç»­"`,
            'ç»§ç»­',
            'å–æ¶ˆ'
        );

        if (result !== 'ç»§ç»­') {
            throw new Error('ç”¨æˆ·å–æ¶ˆäº†å·¥ä½œæµæ‰§è¡Œ');
        }
    }
}
```

#### **ä¿®æ”¹çš„æ–¹æ³•**

```typescript
async executeWorkflow(workflow: Workflow, allScripts: NpmScript[]): Promise<void> {
    for (let i = 0; i < workflow.steps.length; i++) {
        const step = workflow.steps[i];

        // æ ¹æ®æ­¥éª¤ç±»å‹æ‰§è¡Œ
        if (step.type === 'command' && step.command) {
            // æ‰§è¡Œä»»æ„å‘½ä»¤
            await this.executeCommand(workflowName, stepNumber, totalSteps, step);
        } else {
            // æ‰§è¡Œ NPM è„šæœ¬ï¼ˆå…¼å®¹æ—§æ ¼å¼ï¼‰
            // ... åŸæœ‰é€»è¾‘
        }
    }
}
```

**å…³é”®ç‰¹æ€§ï¼š**
- âœ… æ”¯æŒæ‰§è¡Œä»»æ„ shell å‘½ä»¤
- âœ… å…¼å®¹æ—§çš„ NPM è„šæœ¬æ ¼å¼
- âœ… ä¸²è¡Œæ¨¡å¼ç­‰å¾…ç”¨æˆ·ç¡®è®¤
- âœ… å¹¶è¡Œæ¨¡å¼ç«‹å³æ‰§è¡Œä¸‹ä¸€æ­¥

---

### 4. æ›´æ–° `WorkflowTreeProvider` æ˜¾ç¤ºå‘½ä»¤

**æ–‡ä»¶ï¼š** `src/workflowTreeProvider.ts`

#### **ä¿®æ”¹å†…å®¹**

```typescript
class WorkflowStepTreeItem extends vscode.TreeItem {
    constructor(
        public readonly step: WorkflowStep,
        public readonly stepNumber: number
    ) {
        // æ ¹æ®æ­¥éª¤ç±»å‹æ˜¾ç¤ºä¸åŒçš„æ ‡ç­¾
        const label = step.type === 'command' && step.command
            ? `${stepNumber}. ${step.command}`
            : `${stepNumber}. ${step.scriptName}`;
        
        super(label, vscode.TreeItemCollapsibleState.None);
        
        // æ ¹æ®æ­¥éª¤ç±»å‹ç”Ÿæˆä¸åŒçš„ tooltip
        if (step.type === 'command' && step.command) {
            this.tooltip = `å‘½ä»¤: ${step.command}\n` +
                          `æ¨¡å¼: ${mode}\n` +
                          `é”™è¯¯å¤„ç†: ${continueOnError}`;
        } else {
            this.tooltip = `è„šæœ¬: ${step.scriptName}\n` +
                          `è·¯å¾„: ${step.packageJsonPath}\n` +
                          `æ¨¡å¼: ${mode}\n` +
                          `é”™è¯¯å¤„ç†: ${continueOnError}`;
        }
        
        // ä½¿ç”¨ä¸åŒå›¾æ ‡è¡¨ç¤ºæ­¥éª¤ç±»å‹
        if (step.type === 'command') {
            this.iconPath = new vscode.ThemeIcon(
                step.mode === 'serial' ? 'terminal' : 'terminal-bash',
                new vscode.ThemeColor('terminal.ansiGreen')
            );
        } else {
            this.iconPath = new vscode.ThemeIcon(
                step.mode === 'serial' ? 'arrow-right' : 'arrow-both'
            );
        }
    }
}
```

**æ˜¾ç¤ºæ•ˆæœï¼š**
- âœ… å‘½ä»¤æ­¥éª¤æ˜¾ç¤ºå®Œæ•´å‘½ä»¤
- âœ… è„šæœ¬æ­¥éª¤æ˜¾ç¤ºè„šæœ¬åç§°
- âœ… å‘½ä»¤æ­¥éª¤ä½¿ç”¨ç»ˆç«¯å›¾æ ‡ï¼ˆğŸ–¥ï¸ï¼‰
- âœ… è„šæœ¬æ­¥éª¤ä½¿ç”¨ç®­å¤´å›¾æ ‡ï¼ˆâ†’ï¼‰

---

### 5. æ›´æ–° `extension.ts` ä½¿ç”¨æ–°åˆ›å»ºå™¨

**æ–‡ä»¶ï¼š** `src/extension.ts`

#### **ä¿®æ”¹å†…å®¹**

```typescript
// å¯¼å…¥ WorkflowCreator
import { WorkflowCreator } from './workflowCreator';

// åˆ›å»ºå·¥ä½œæµå‘½ä»¤
const workflowCreator = new WorkflowCreator();
const createWorkflowCommand = vscode.commands.registerCommand(
    'scriptButler.createWorkflow',
    async () => {
        const allScripts = scriptsTreeProvider.getAllScripts();

        // ä½¿ç”¨æ–°çš„å·¥ä½œæµåˆ›å»ºå™¨
        const result = await workflowCreator.createWorkflow(allScripts);

        if (!result) {
            return;
        }

        await workflowManager.createWorkflow(result.name, result.description, result.steps);
        workflowTreeProvider.refresh();
        vscode.window.showInformationMessage(`å·¥ä½œæµ "${result.name}" å·²åˆ›å»º`);
    }
);
```

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### åˆ›å»ºå·¥ä½œæµ - æ¨¡å¼ 1ï¼šä»åˆ—è¡¨é€‰æ‹©

1. æ‰“å¼€"è„šæœ¬ç®¡å®¶"ä¾§è¾¹æ 
2. ç‚¹å‡»"å·¥ä½œæµ"è§†å›¾çš„ â• æŒ‰é’®
3. è¾“å…¥å·¥ä½œæµåç§°ï¼ˆå¦‚ "å®Œæ•´éƒ¨ç½²æµç¨‹"ï¼‰
4. è¾“å…¥æè¿°ï¼ˆå¯é€‰ï¼‰
5. é€‰æ‹©åˆ›å»ºæ–¹å¼ï¼š**"ä»åˆ—è¡¨é€‰æ‹©"**
6. ä»åˆ—è¡¨ä¸­é€‰æ‹©å¤šä¸ª NPM è„šæœ¬
7. ç‚¹å‡»"ç¡®å®š"

**é€‚ç”¨åœºæ™¯ï¼š**
- å·¥ä½œæµåªåŒ…å«ç°æœ‰çš„ NPM è„šæœ¬
- å¿«é€Ÿåˆ›å»ºç®€å•å·¥ä½œæµ

---

### åˆ›å»ºå·¥ä½œæµ - æ¨¡å¼ 2ï¼šæ–‡æœ¬è¾“å…¥

1. æ‰“å¼€"è„šæœ¬ç®¡å®¶"ä¾§è¾¹æ 
2. ç‚¹å‡»"å·¥ä½œæµ"è§†å›¾çš„ â• æŒ‰é’®
3. è¾“å…¥å·¥ä½œæµåç§°ï¼ˆå¦‚ "å‰åç«¯è”åˆéƒ¨ç½²"ï¼‰
4. è¾“å…¥æè¿°ï¼ˆå¯é€‰ï¼‰
5. é€‰æ‹©åˆ›å»ºæ–¹å¼ï¼š**"æ–‡æœ¬è¾“å…¥"**
6. åœ¨æ‰“å¼€çš„ç¼–è¾‘å™¨ä¸­è¾“å…¥å‘½ä»¤åºåˆ—ï¼š

```bash
# å‰ç«¯æ„å»º
cd packages/frontend
npm install
npm run build

# åç«¯æµ‹è¯•
cd ../backend
npm run test

# éƒ¨ç½²
npm run deploy
```

7. ç‚¹å‡»"ç¡®å®š"
8. æŸ¥çœ‹é¢„è§ˆï¼Œç¡®è®¤æ­¥éª¤
9. ç‚¹å‡»"ç¡®å®š"åˆ›å»ºå·¥ä½œæµ

**é€‚ç”¨åœºæ™¯ï¼š**
- éœ€è¦æ‰§è¡Œä»»æ„ shell å‘½ä»¤
- éœ€è¦åˆ‡æ¢ç›®å½•
- éœ€è¦å®‰è£…ä¾èµ–
- éœ€è¦æ··åˆä½¿ç”¨å¤šç§å‘½ä»¤
- ä»å…¶ä»–åœ°æ–¹å¤åˆ¶ç²˜è´´å‘½ä»¤åºåˆ—

---

### æ‰§è¡Œå·¥ä½œæµ

1. æ‰“å¼€"å·¥ä½œæµ"è§†å›¾
2. ç‚¹å‡»å·¥ä½œæµåç§°
3. å·¥ä½œæµå¼€å§‹æ‰§è¡Œ
4. æ¯ä¸ªæ­¥éª¤æ‰§è¡Œå®Œæˆåï¼Œç‚¹å‡»"ç»§ç»­"æ‰§è¡Œä¸‹ä¸€æ­¥
5. æ‰€æœ‰æ­¥éª¤å®Œæˆåï¼Œæ˜¾ç¤ºæ‰§è¡Œç»“æœ

---

## ğŸ“Š æ•°æ®ç»“æ„

### å·¥ä½œæµæ­¥éª¤ç¤ºä¾‹

#### **NPM è„šæœ¬æ­¥éª¤**

```json
{
  "type": "script",
  "scriptName": "build",
  "packageJsonPath": "d:\\project\\package.json",
  "mode": "serial",
  "continueOnError": false
}
```

#### **å‘½ä»¤æ­¥éª¤**

```json
{
  "type": "command",
  "command": "npm run clean",
  "mode": "serial",
  "continueOnError": false
}
```

#### **å®Œæ•´å·¥ä½œæµç¤ºä¾‹**

```json
{
  "id": "workflow-1234567890",
  "name": "å‰åç«¯è”åˆéƒ¨ç½²",
  "description": "æ„å»ºå‰ç«¯ã€æµ‹è¯•åç«¯ã€éƒ¨ç½²åº”ç”¨",
  "steps": [
    {
      "type": "command",
      "command": "cd packages/frontend",
      "mode": "serial",
      "continueOnError": false
    },
    {
      "type": "command",
      "command": "npm install",
      "mode": "serial",
      "continueOnError": false
    },
    {
      "type": "script",
      "scriptName": "build",
      "packageJsonPath": "d:\\project\\packages\\frontend\\package.json",
      "mode": "serial",
      "continueOnError": false
    },
    {
      "type": "command",
      "command": "cd ../backend",
      "mode": "serial",
      "continueOnError": false
    },
    {
      "type": "script",
      "scriptName": "test",
      "packageJsonPath": "d:\\project\\packages\\backend\\package.json",
      "mode": "serial",
      "continueOnError": false
    }
  ]
}
```

---

## âœ… éªŒè¯æ¸…å•

### åŠŸèƒ½éªŒè¯

- [ ] å¯ä»¥é€‰æ‹©"ä»åˆ—è¡¨é€‰æ‹©"æ¨¡å¼åˆ›å»ºå·¥ä½œæµ
- [ ] å¯ä»¥é€‰æ‹©"æ–‡æœ¬è¾“å…¥"æ¨¡å¼åˆ›å»ºå·¥ä½œæµ
- [ ] æ–‡æœ¬è¾“å…¥æ¨¡å¼æ‰“å¼€ä¸´æ—¶ç¼–è¾‘å™¨
- [ ] ç¼–è¾‘å™¨æä¾›è¯­æ³•é«˜äº®
- [ ] å¯ä»¥è¾“å…¥å¤šè¡Œå‘½ä»¤
- [ ] æ³¨é‡Šè¡Œï¼ˆä»¥ `#` å¼€å¤´ï¼‰è¢«æ­£ç¡®å¿½ç•¥
- [ ] æ˜¾ç¤ºæ­¥éª¤é¢„è§ˆ
- [ ] å·¥ä½œæµè§†å›¾æ­£ç¡®æ˜¾ç¤ºå‘½ä»¤æ­¥éª¤
- [ ] å‘½ä»¤æ­¥éª¤ä½¿ç”¨ç»ˆç«¯å›¾æ ‡
- [ ] è„šæœ¬æ­¥éª¤ä½¿ç”¨ç®­å¤´å›¾æ ‡
- [ ] å¯ä»¥æ‰§è¡ŒåŒ…å«å‘½ä»¤çš„å·¥ä½œæµ
- [ ] å‘½ä»¤æ­£ç¡®å‘é€åˆ°ç»ˆç«¯
- [ ] ä¸²è¡Œæ¨¡å¼ç­‰å¾…ç”¨æˆ·ç¡®è®¤
- [ ] å·¥ä½œæµæŒä¹…åŒ–ä¿å­˜

### è¾¹ç•Œæƒ…å†µ

- [ ] è¾“å…¥ç©ºå†…å®¹æ—¶æ˜¾ç¤ºé”™è¯¯
- [ ] åªæœ‰æ³¨é‡Šè¡Œæ—¶æ˜¾ç¤ºé”™è¯¯
- [ ] å–æ¶ˆåˆ›å»ºæ—¶ä¸ä¿å­˜å·¥ä½œæµ
- [ ] æ—§æ ¼å¼çš„å·¥ä½œæµä»ç„¶å¯ä»¥æ‰§è¡Œ
- [ ] æ··åˆè„šæœ¬å’Œå‘½ä»¤çš„å·¥ä½œæµæ­£å¸¸å·¥ä½œ

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

### æ–°å¢æ–‡ä»¶

1. **`src/workflowCreator.ts`** - å·¥ä½œæµåˆ›å»ºå™¨

### ä¿®æ”¹çš„æ–‡ä»¶

1. **`src/types.ts`** - æ‰©å±• WorkflowStep ç±»å‹
2. **`src/workflowExecutor.ts`** - æ”¯æŒæ‰§è¡Œä»»æ„å‘½ä»¤
3. **`src/workflowTreeProvider.ts`** - æ˜¾ç¤ºå‘½ä»¤æ­¥éª¤
4. **`src/extension.ts`** - ä½¿ç”¨æ–°çš„åˆ›å»ºå™¨

---

## ğŸ‰ æ€»ç»“

**é—®é¢˜ï¼š** å·¥ä½œæµåˆ›å»ºåŠŸèƒ½ä¸å¤Ÿçµæ´»ï¼Œåªèƒ½é€‰æ‹©ç°æœ‰è„šæœ¬

**è§£å†³æ–¹æ¡ˆï¼š** æä¾›ä¸¤ç§åˆ›å»ºæ¨¡å¼ï¼Œæ”¯æŒæ–‡æœ¬è¾“å…¥ä»»æ„å‘½ä»¤

**å®ç°æ•ˆæœï¼š**
- âœ… ä¿ç•™åŸæœ‰çš„"ä»åˆ—è¡¨é€‰æ‹©"æ¨¡å¼
- âœ… æ–°å¢"æ–‡æœ¬è¾“å…¥"æ¨¡å¼
- âœ… æ”¯æŒä»»æ„ shell å‘½ä»¤
- âœ… æ”¯æŒæ··åˆä½¿ç”¨è„šæœ¬å’Œå‘½ä»¤
- âœ… æä¾›å¤šè¡Œç¼–è¾‘å™¨è¾“å…¥ä½“éªŒ
- âœ… æ”¯æŒæ³¨é‡Šï¼ˆä»¥ `#` å¼€å¤´ï¼‰
- âœ… æ˜¾ç¤ºæ­¥éª¤é¢„è§ˆ
- âœ… å…¼å®¹æ—§æ ¼å¼å·¥ä½œæµ
- âœ… å‘½ä»¤å’Œè„šæœ¬ä½¿ç”¨ä¸åŒå›¾æ ‡

**ç°åœ¨å¯ä»¥åˆ›å»ºæ›´çµæ´»ã€æ›´å¼ºå¤§çš„å·¥ä½œæµäº†ï¼** ğŸš€

